<script>
  const params = new URLSearchParams(window.location.search);

  const cd = params.get("cd");
  const plataforma = params.get("p");
  const tipo = params.get("t");
  const id = params.get("id");

  const userAgent = navigator.userAgent;
  const os =
    userAgent.includes("iPhone") || userAgent.includes("iPad")
      ? "iOS"
      : "Android";

  // URL de registro (NO bloqueante)
  const logURL =
    "https://script.google.com/macros/s/AKfycbxbN5yh9h4se8LsPlWL3JKuAk9a-AEZStFHk9rYqQLk/exec" +
    `?cd=${cd}&p=${plataforma}&t=${tipo}&id=${id}&os=${os}`;

  // Registro silencioso (sin esperar respuesta)
  const img = new Image();
  img.src = logURL;

  // RedirecciÃ³n garantizada
  if (plataforma === "Spotify" && tipo === "track" && id) {
    setTimeout(() => {
      window.location.href =
        "https://open.spotify.com/track/" + id;
    }, 300);
  } else {
    document.body.innerHTML = "<p>Contenido no disponible</p>";
  }
</script>